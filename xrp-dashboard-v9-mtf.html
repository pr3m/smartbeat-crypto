<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XRP Trading Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>
    <style>
        :root {
            --bg: #0d1117; --bg2: #161b22; --bg3: #21262d;
            --border: #30363d; --text: #e6edf3; --text2: #8b949e; --text3: #6e7681;
            --green: #3fb950; --green-bg: rgba(63,185,80,0.15);
            --red: #f85149; --red-bg: rgba(248,81,73,0.15);
            --blue: #58a6ff; --yellow: #d29922; --orange: #db6d28;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); font-size: 14px; }
        .mono { font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, monospace; }
        
        .header { background: var(--bg2); padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); position: relative; z-index: 100; }
        .title { font-size: 18px; font-weight: 600; }
        .title span { color: var(--text3); font-weight: 400; }
        .status { display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text2); }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--yellow); }
        .dot.ok { background: var(--green); }
        .dot.err { background: var(--red); }
        
        .error-box { background: var(--red-bg); border: 1px solid var(--red); color: var(--red); padding: 12px 16px; margin: 16px; border-radius: 6px; font-size: 13px; display: none; }
        .error-box.show { display: block; }
        
        .grid { display: grid; grid-template-columns: 1fr 380px; position: relative; }
        .main { padding: 24px; position: relative; z-index: 1; }
        .side { background: var(--bg2); padding: 24px; border-left: 1px solid var(--border); overflow-y: auto; overflow-x: visible; max-height: calc(100vh - 60px); position: relative; z-index: 10; }
        
        /* Main Recommendation Box */
        .rec-box { background: var(--bg2); border-radius: 12px; padding: 24px; margin-bottom: 24px; text-align: center; border: 2px solid var(--border); }
        .rec-box.long { border-color: var(--green); background: linear-gradient(135deg, rgba(63,185,80,0.1), transparent); }
        .rec-box.short { border-color: var(--red); background: linear-gradient(135deg, rgba(248,81,73,0.1), transparent); }
        .rec-box.wait { border-color: var(--yellow); }
        .rec-label { font-size: 11px; color: var(--text3); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
        .rec-action { font-size: 42px; font-weight: 800; margin-bottom: 8px; }
        .rec-action.long { color: var(--green); }
        .rec-action.short { color: var(--red); }
        .rec-action.wait { color: var(--yellow); }
        .rec-reason { font-size: 13px; color: var(--text2); margin-bottom: 16px; line-height: 1.5; }
        .rec-confidence { display: inline-flex; align-items: center; gap: 8px; background: var(--bg3); padding: 8px 16px; border-radius: 20px; font-size: 12px; }
        .rec-confidence-bar { width: 60px; height: 6px; background: var(--bg); border-radius: 3px; overflow: hidden; }
        .rec-confidence-fill { height: 100%; border-radius: 3px; }
        
        .price-row { display: flex; align-items: baseline; gap: 12px; margin-bottom: 20px; }
        .price { font-size: 32px; font-weight: 700; font-family: ui-monospace, monospace; }
        .change { font-size: 14px; font-weight: 600; padding: 4px 8px; border-radius: 4px; }
        .change.up { color: var(--green); background: var(--green-bg); }
        .change.dn { color: var(--red); background: var(--red-bg); }
        
        .stats { display: flex; gap: 24px; margin-bottom: 24px; font-size: 12px; }
        .stat-lbl { color: var(--text3); margin-bottom: 4px; }
        .stat-val { font-family: ui-monospace, monospace; color: var(--text2); }
        
        /* Multi-timeframe Analysis */
        .mtf-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 24px; }
        .mtf-card { background: var(--bg2); border-radius: 8px; padding: 16px; text-align: center; border: 1px solid var(--border); }
        .mtf-card.bullish { border-color: var(--green); }
        .mtf-card.bearish { border-color: var(--red); }
        .mtf-tf { font-size: 11px; color: var(--text3); text-transform: uppercase; margin-bottom: 8px; }
        .mtf-bias { font-size: 16px; font-weight: 700; margin-bottom: 4px; }
        .mtf-bias.bull { color: var(--green); }
        .mtf-bias.bear { color: var(--red); }
        .mtf-bias.neut { color: var(--text3); }
        .mtf-detail { font-size: 10px; color: var(--text3); }
        .mtf-weight { font-size: 9px; color: var(--text3); margin-top: 6px; opacity: 0.7; }
        
        .chart-box { background: var(--bg2); border-radius: 8px; padding: 16px; margin-bottom: 24px; }
        .chart-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .chart-title { font-size: 12px; color: var(--text2); }
        .tf-btns { display: flex; gap: 4px; }
        .tf-btn { padding: 4px 10px; background: var(--bg3); border: 1px solid var(--border); border-radius: 4px; color: var(--text3); font-size: 11px; cursor: pointer; }
        .tf-btn:hover { border-color: var(--text3); }
        .tf-btn.on { background: var(--blue); color: #fff; border-color: var(--blue); }
        .chart-wrap { height: 280px; }
        
        /* Indicators Compact */
        .ind-row { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; }
        .ind-mini { background: var(--bg2); border-radius: 6px; padding: 10px; text-align: center; }
        .ind-mini-lbl { font-size: 9px; color: var(--text3); text-transform: uppercase; margin-bottom: 4px; }
        .ind-mini-val { font-family: ui-monospace, monospace; font-size: 14px; font-weight: 600; }
        .ind-mini-sig { font-size: 9px; margin-top: 2px; }
        
        .section { margin-bottom: 20px; }
        .sec-title { font-size: 11px; font-weight: 600; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; display: flex; align-items: center; gap: 6px; }
        .help-icon { display: inline-flex; align-items: center; justify-content: center; width: 14px; height: 14px; border-radius: 50%; background: var(--bg3); color: var(--text3); font-size: 9px; cursor: help; }
        
        /* Entry Checklist */
        .checklist { background: var(--bg3); border-radius: 8px; padding: 16px; }
        .chk-row { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 12px; }
        .chk-row:last-child { border-bottom: none; }
        .chk-icon { width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; }
        .chk-icon.pass { background: var(--green); color: #000; }
        .chk-icon.fail { background: var(--red); color: #fff; }
        .chk-icon.warn { background: var(--yellow); color: #000; }
        .chk-text { flex: 1; }
        .chk-val { font-family: ui-monospace, monospace; font-size: 11px; color: var(--text2); }
        
        /* Calculator */
        .calc-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .calc-lbl { font-size: 10px; color: var(--text3); text-transform: uppercase; margin-bottom: 4px; }
        .calc-in { width: 100%; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; padding: 8px 10px; color: var(--text); font-family: ui-monospace, monospace; font-size: 12px; }
        .calc-in:focus { outline: none; border-color: var(--blue); }
        .calc-results { background: var(--bg); border-radius: 6px; padding: 12px; }
        .calc-res-row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 12px; border-bottom: 1px solid var(--border); }
        .calc-res-row:last-child { border-bottom: none; }
        .calc-res-lbl { color: var(--text2); }
        .calc-res-val { font-family: ui-monospace, monospace; font-weight: 600; }
        
        /* DCA Table */
        .dca { width: 100%; border-collapse: collapse; font-size: 11px; }
        .dca th { text-align: left; font-size: 10px; color: var(--text3); text-transform: uppercase; padding: 8px 4px; border-bottom: 1px solid var(--border); }
        .dca td { padding: 8px 4px; font-family: ui-monospace, monospace; border-bottom: 1px solid var(--border); }
        .dca tr:last-child td { border-bottom: none; }
        .badge { background: var(--blue); color: #fff; padding: 2px 6px; border-radius: 3px; font-size: 10px; }
        
        /* Action Buttons */
        .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 16px; }
        .btn { padding: 14px; border: none; border-radius: 8px; font-weight: 600; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-long { background: var(--green); color: #000; }
        .btn-long:hover { background: #4cc764; }
        .btn-short { background: var(--red); color: #fff; }
        .btn-short:hover { background: #f96a5e; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Quick Rules */
        .rules { background: var(--bg); border-radius: 6px; padding: 12px; font-size: 11px; line-height: 1.8; color: var(--text2); }
        .rules div { display: flex; align-items: center; gap: 8px; }
        
        /* Tooltips - default shows to the right */
        [data-tip] { position: relative; cursor: help; }
        [data-tip]::after {
            content: attr(data-tip);
            position: absolute; 
            left: calc(100% + 12px); 
            top: 50%; 
            transform: translateY(-50%);
            background: #1a1f24; color: #e6edf3; padding: 12px 16px; border-radius: 8px;
            font-size: 12px; font-weight: 400; line-height: 1.6; white-space: normal;
            width: max-content; max-width: 300px; box-shadow: 0 12px 40px rgba(0,0,0,0.5);
            border: 1px solid var(--border); opacity: 0; visibility: hidden;
            transition: opacity 0.15s; z-index: 9999; text-align: left; pointer-events: none;
        }
        [data-tip]:hover::after { opacity: 1; visibility: visible; }
        
        /* Tooltip positioned below */
        [data-tip-pos="bottom"]::after {
            left: 50%; top: calc(100% + 10px); bottom: auto; right: auto;
            transform: translateX(-50%);
        }
        /* Tooltip positioned above */
        [data-tip-pos="top"]::after {
            left: 50%; bottom: calc(100% + 10px); top: auto; right: auto;
            transform: translateX(-50%);
        }
        /* Tooltip positioned left - for main content */
        [data-tip-pos="left"]::after {
            right: calc(100% + 12px); left: auto; top: 50%;
            transform: translateY(-50%);
        }
        /* Tooltip for sidebar - appears above with left alignment */
        .side [data-tip]::after {
            left: 0; right: auto; top: auto; bottom: calc(100% + 10px);
            transform: none;
            max-width: 340px;
        }
        /* Override for specific positions in sidebar */
        .side [data-tip-pos="top"]::after {
            left: 0; right: auto;
            transform: none;
        }
        
        .toast-box { position: fixed; top: 80px; right: 20px; z-index: 1000; }
        .toast { background: var(--bg2); border: 1px solid var(--border); border-radius: 8px; padding: 14px 18px; margin-bottom: 8px; min-width: 280px; box-shadow: 0 8px 30px rgba(0,0,0,0.4); }
        .toast-title { font-weight: 600; margin-bottom: 4px; }
        .toast-msg { font-size: 12px; color: var(--text2); }
        
        @media (max-width: 1100px) { 
            .grid { grid-template-columns: 1fr; } 
            .side { border-left: none; border-top: 1px solid var(--border); max-height: none; }
            .mtf-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="title">XRP Dashboard <span>/ Multi-Timeframe Analysis</span></div>
        <div class="status"><div class="dot" id="dot"></div><span id="statusTxt">Connecting...</span></div>
    </header>
    
    <div class="error-box" id="errBox"></div>
    
    <div class="grid">
        <div class="main">
            <!-- Main Recommendation -->
            <div class="rec-box" id="recBox" data-tip="This is your final answer. LONG/SHORT = conditions met, buttons enabled. WAIT = stay out. SPIKE = quick momentum play with tight stops. Always follow this recommendation." data-tip-pos="bottom">
                <div class="rec-label">Recommendation</div>
                <div class="rec-action wait" id="recAction">ANALYZING...</div>
                <div class="rec-reason" id="recReason">Loading multi-timeframe data...</div>
                <div class="rec-confidence" data-tip="Confidence based on how many conditions align. 70%+ = high conviction. 40-70% = moderate. Below 40% = weak setup, better to wait.">
                    <span>Confidence:</span>
                    <div class="rec-confidence-bar"><div class="rec-confidence-fill" id="recConf" style="width: 0%; background: var(--yellow);"></div></div>
                    <span id="recConfPct">0%</span>
                </div>
            </div>
            
            <div class="price-row">
                <div class="price mono" id="price">‚Ç¨0.0000</div>
                <div class="change up" id="chg">+0.00%</div>
                <div class="stats">
                    <div><div class="stat-lbl">24h High</div><div class="stat-val" id="hi">-</div></div>
                    <div><div class="stat-lbl">24h Low</div><div class="stat-val" id="lo">-</div></div>
                    <div><div class="stat-lbl">Volume</div><div class="stat-val" id="vol">-</div></div>
                </div>
            </div>
            
            <!-- Multi-Timeframe Analysis -->
            <div class="section">
                <div class="sec-title">
                    Multi-Timeframe Analysis
                    <span class="help-icon" data-tip="Each timeframe is analyzed independently. 4H determines trend (40% weight), 1H confirms setup (30%), 15m times entry (20%), 5m detects spikes (10%).">?</span>
                </div>
                <div class="mtf-grid">
                    <div class="mtf-card" id="mtf4h" data-tip="4-HOUR: Your trend compass. This timeframe sets the overall direction. NEVER trade against 4H bias - if it's bearish, only look for shorts." data-tip-pos="bottom">
                        <div class="mtf-tf">4 Hour</div>
                        <div class="mtf-bias neut" id="bias4h">‚Äî</div>
                        <div class="mtf-detail" id="detail4h">RSI: ‚Äî | BB: ‚Äî</div>
                        <div class="mtf-weight">Weight: 40%</div>
                    </div>
                    <div class="mtf-card" id="mtf1h" data-tip="1-HOUR: Setup confirmation. Should agree with 4H direction. If 4H is bullish but 1H is bearish, the setup isn't ready yet - wait." data-tip-pos="bottom">
                        <div class="mtf-tf">1 Hour</div>
                        <div class="mtf-bias neut" id="bias1h">‚Äî</div>
                        <div class="mtf-detail" id="detail1h">RSI: ‚Äî | BB: ‚Äî</div>
                        <div class="mtf-weight">Weight: 30%</div>
                    </div>
                    <div class="mtf-card" id="mtf15m" data-tip="15-MIN: Entry timing. Look for RSI extremes here (<35 for longs, >65 for shorts). This is where you pull the trigger once 4H and 1H align." data-tip-pos="bottom">
                        <div class="mtf-tf">15 Min</div>
                        <div class="mtf-bias neut" id="bias15m">‚Äî</div>
                        <div class="mtf-detail" id="detail15m">RSI: ‚Äî | BB: ‚Äî</div>
                        <div class="mtf-weight">Weight: 20%</div>
                    </div>
                    <div class="mtf-card" id="mtf5m" data-tip="5-MIN: Spike detection only. Used to catch sudden momentum moves with 2x+ volume. Not for trend analysis - too noisy for that." data-tip-pos="bottom">
                        <div class="mtf-tf">5 Min</div>
                        <div class="mtf-bias neut" id="bias5m">‚Äî</div>
                        <div class="mtf-detail" id="detail5m">RSI: ‚Äî | BB: ‚Äî</div>
                        <div class="mtf-weight">Spike Detection</div>
                    </div>
                </div>
            </div>
            
            <!-- Chart -->
            <div class="chart-box">
                <div class="chart-head">
                    <div class="chart-title">Price Chart</div>
                    <div class="tf-btns">
                        <button class="tf-btn" data-tf="5">5m</button>
                        <button class="tf-btn on" data-tf="15">15m</button>
                        <button class="tf-btn" data-tf="60">1H</button>
                        <button class="tf-btn" data-tf="240">4H</button>
                    </div>
                </div>
                <div class="chart-wrap"><canvas id="chart"></canvas></div>
            </div>
            
            <!-- Current TF Indicators -->
            <div class="ind-row">
                <div class="ind-mini" data-tip="RSI on selected timeframe. <35 oversold, >65 overbought.">
                    <div class="ind-mini-lbl">RSI</div>
                    <div class="ind-mini-val" id="indRsi">-</div>
                    <div class="ind-mini-sig" id="indRsiS">-</div>
                </div>
                <div class="ind-mini" data-tip="MACD histogram. Positive = bullish momentum.">
                    <div class="ind-mini-lbl">MACD</div>
                    <div class="ind-mini-val" id="indMacd">-</div>
                    <div class="ind-mini-sig" id="indMacdS">-</div>
                </div>
                <div class="ind-mini" data-tip="Position within Bollinger Bands. 0%=lower, 100%=upper.">
                    <div class="ind-mini-lbl">BB%</div>
                    <div class="ind-mini-val" id="indBb">-</div>
                    <div class="ind-mini-sig" id="indBbS">-</div>
                </div>
                <div class="ind-mini" data-tip="ATR as % of price. Higher = more volatile.">
                    <div class="ind-mini-lbl">ATR%</div>
                    <div class="ind-mini-val" id="indAtr">-</div>
                    <div class="ind-mini-sig" id="indAtrS">-</div>
                </div>
                <div class="ind-mini" data-tip="Volume vs 20-period average. >1.3x is strong.">
                    <div class="ind-mini-lbl">Vol</div>
                    <div class="ind-mini-val" id="indVol">-</div>
                    <div class="ind-mini-sig" id="indVolS">-</div>
                </div>
                <div class="ind-mini" data-tip="BTC 24h trend. Don't fight Bitcoin.">
                    <div class="ind-mini-lbl">BTC</div>
                    <div class="ind-mini-val" id="indBtc">-</div>
                    <div class="ind-mini-sig" id="indBtcS">-</div>
                </div>
            </div>
        </div>
        
        <div class="side">
            <!-- Entry Checklist -->
            <div class="section">
                <div class="sec-title">Entry Checklist <span class="help-icon" data-tip="Shows conditions for BOTH long and short setups. Green = condition met. Red = not met. Need 5/6 for high-confidence entry.">?</span></div>
                <div class="setup-direction" id="setupDir" style="background: var(--bg); border-radius: 6px; padding: 10px 12px; margin-bottom: 12px; font-size: 12px; text-align: center;">
                    Evaluating setups...
                </div>
                <div class="checklist">
                    <div class="chk-row" data-tip="4H timeframe determines the dominant trend. For LONG: need bullish bias. For SHORT: need bearish bias. Never trade against the 4H trend.">
                        <div class="chk-icon fail" id="chk0">‚úó</div>
                        <div class="chk-text">4H trend supports direction</div>
                        <div class="chk-val" id="chk0v">-</div>
                    </div>
                    <div class="chk-row" data-tip="1H must confirm the 4H direction. Both timeframes should agree on trend direction before considering entry.">
                        <div class="chk-icon fail" id="chk1">‚úó</div>
                        <div class="chk-text">1H setup confirmed</div>
                        <div class="chk-val" id="chk1v">-</div>
                    </div>
                    <div class="chk-row" data-tip="15m RSI provides entry timing. For LONG: RSI should be oversold (<35). For SHORT: RSI should be overbought (>65). This catches reversals.">
                        <div class="chk-icon fail" id="chk2">‚úó</div>
                        <div class="chk-text">15m entry signal</div>
                        <div class="chk-val" id="chk2v">-</div>
                    </div>
                    <div class="chk-row" data-tip="Volume must be >1.3x the 20-period average. High volume confirms conviction behind the move. Low volume entries often fail.">
                        <div class="chk-icon fail" id="chk3">‚úó</div>
                        <div class="chk-text">Volume confirms (>1.3x)</div>
                        <div class="chk-val" id="chk3v">-</div>
                    </div>
                    <div class="chk-row" data-tip="Bitcoin sets market direction. For LONG XRP: BTC should not be bearish. For SHORT XRP: BTC should not be bullish. XRP follows BTC ~80% of the time.">
                        <div class="chk-icon fail" id="chk4">‚úó</div>
                        <div class="chk-text">BTC trend aligned</div>
                        <div class="chk-val" id="chk4v">-</div>
                    </div>
                    <div class="chk-row" data-tip="RSI must be at an extreme for mean-reversion entries. <35 = oversold (buy zone). >65 = overbought (sell zone). Middle readings = no edge.">
                        <div class="chk-icon fail" id="chk5">‚úó</div>
                        <div class="chk-text">RSI at extreme (<35 or >65)</div>
                        <div class="chk-val" id="chk5v">-</div>
                    </div>
                </div>
                <div style="margin-top: 10px; padding: 10px; background: var(--bg); border-radius: 6px; font-size: 11px; display: flex; justify-content: space-between;">
                    <span>LONG: <strong id="longScore">0</strong>/6</span>
                    <span>SHORT: <strong id="shortScore">0</strong>/6</span>
                </div>
            </div>
            
            <!-- Calculator -->
            <div class="section">
                <div class="sec-title">Position Calculator <span class="help-icon" data-tip="Calculate your position size and exit levels. Uses 10x leverage by default. Always know your TP and SL before entering!">?</span></div>
                <div class="calc-row">
                    <div data-tip="Your capital for this trade. Max recommended: ‚Ç¨2,000 from a ‚Ç¨15k portfolio.">
                        <div class="calc-lbl">Capital ‚Ç¨</div>
                        <input type="number" class="calc-in" id="cap" value="2000">
                    </div>
                    <div data-tip="Your profit target in EUR. ‚Ç¨500-1000 is realistic per trade.">
                        <div class="calc-lbl">Target ‚Ç¨</div>
                        <input type="number" class="calc-in" id="targ" value="500">
                    </div>
                </div>
                <div class="calc-results">
                    <div class="calc-res-row" data-tip="Your effective position (Capital √ó 10x leverage).">
                        <span class="calc-res-lbl">Position (10x)</span>
                        <span class="calc-res-val" id="pos">‚Ç¨20,000</span>
                    </div>
                    <div class="calc-res-row" data-tip="Price change needed to hit your target profit.">
                        <span class="calc-res-lbl">Move needed</span>
                        <span class="calc-res-val" id="mv">2.50%</span>
                    </div>
                    <div class="calc-res-row" data-tip="Set your take-profit order at this price. Consider taking 50% here and trailing the rest.">
                        <span class="calc-res-lbl">Take Profit</span>
                        <span class="calc-res-val" id="tp">-</span>
                    </div>
                    <div class="calc-res-row" data-tip="HARD STOP - Exit everything at this price. -8% is non-negotiable. NEVER move this stop further away.">
                        <span class="calc-res-lbl">Stop Loss (-8%)</span>
                        <span class="calc-res-val" id="sl" style="color:var(--red)">-</span>
                    </div>
                </div>
            </div>
            
            <!-- DCA -->
            <div class="section">
                <div class="sec-title">DCA Levels <span class="help-icon" data-tip="Dollar-Cost Averaging: If trade goes against you, add at predetermined levels to lower average entry. MAX 3x initial. Never DCA spike trades!">?</span></div>
                <table class="dca">
                    <thead><tr><th>Level</th><th>Trigger</th><th>Add</th><th>Price</th></tr></thead>
                    <tbody>
                        <tr data-tip="Initial entry when 5/6 conditions pass. Start with only 20% of your capital.">
                            <td><span class="badge">Entry</span></td><td>Signal</td><td>‚Ç¨400</td><td id="d0">-</td>
                        </tr>
                        <tr data-tip="First DCA at -3%. Only add if thesis still valid. Total position now ‚Ç¨700.">
                            <td>DCA 1</td><td>-3%</td><td>‚Ç¨300</td><td id="d1">-</td>
                        </tr>
                        <tr data-tip="Final DCA at -5%. Position maxed at ‚Ç¨1,200. No more adds after this.">
                            <td>DCA 2</td><td>-5%</td><td>‚Ç¨500</td><td id="d2">-</td>
                        </tr>
                        <tr data-tip="HARD STOP at -8%. Close EVERYTHING. No exceptions. Max loss ~‚Ç¨240-300.">
                            <td style="color:var(--red)">STOP</td><td>-8%</td><td>Exit</td><td id="d3" style="color:var(--red)">-</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Rules -->
            <div class="section">
                <div class="sec-title">Quick Rules</div>
                <div class="rules">
                    <div data-tip="Wait for at least 5 of 6 checklist items to pass. 4/6 = developing setup, wait.">‚úì Wait for 5/6 checks to pass</div>
                    <div data-tip="Set stop at -8% from entry immediately. Never move it further away. Ever.">üõë Always set -8% hard stop</div>
                    <div data-tip="Funding fees eat profits. Close within 72 hours regardless of P&L.">‚è∞ Close positions after 72h</div>
                    <div data-tip="If you hit ‚Ç¨150 loss in a day, stop trading. Review what went wrong.">üìä Max ‚Ç¨150 daily loss limit</div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-btns">
                <button class="btn btn-long" id="btnLong" disabled onclick="window.open('https://pro.kraken.com/app/trade/xrp-eur')" data-tip="Opens Kraken Pro to enter LONG position. Only enabled when conditions align. Don't click when disabled!">
                    <span>‚Üë</span> LONG
                </button>
                <button class="btn btn-short" id="btnShort" disabled onclick="window.open('https://pro.kraken.com/app/trade/xrp-eur')" data-tip="Opens Kraken Pro to enter SHORT position. Only enabled when conditions align. Don't click when disabled!">
                    <span>‚Üì</span> SHORT
                </button>
            </div>
            <div style="text-align: center; margin-top: 8px; font-size: 11px; color: var(--text3);">
                Buttons enable when conditions align
            </div>
        </div>
    </div>
    
    <div class="toast-box" id="toasts"></div>

<script>
(function() {
    'use strict';
    
    const PROXY = 'https://corsproxy.io/?';
    const API = 'https://api.kraken.com/0/public/';
    let useProxy = false;
    
    // Multi-timeframe data storage
    let tfData = {
        5: { ohlc: [], ind: null },
        15: { ohlc: [], ind: null },
        60: { ohlc: [], ind: null },
        240: { ohlc: [], ind: null }
    };
    
    let price = 0, openP = 0, displayTf = 15;
    let btcChange = 0, btcTrend = 'neutral';
    let chart = null;
    let lastRecommendation = null;
    
    const $ = id => document.getElementById(id);
    
    async function init() {
        setupChart();
        setupEvents();
        await loadAllData();
        setInterval(loadAllData, 8000); // Refresh every 8 seconds
    }
    
    async function apiFetch(endpoint) {
        const url = API + endpoint;
        try {
            if (!useProxy) {
                const res = await fetch(url);
                if (!res.ok) throw new Error('HTTP ' + res.status);
                return await res.json();
            }
        } catch(e) {
            useProxy = true;
        }
        const res = await fetch(PROXY + encodeURIComponent(url));
        if (!res.ok) throw new Error('Proxy HTTP ' + res.status);
        return await res.json();
    }
    
    async function loadAllData() {
        try {
            setStatus('load');
            
            // Fetch all timeframes + tickers in parallel
            const [tick, btcTick, ohlc5, ohlc15, ohlc60, ohlc240] = await Promise.all([
                apiFetch('Ticker?pair=XRPEUR'),
                apiFetch('Ticker?pair=XBTEUR'),
                apiFetch('OHLC?pair=XRPEUR&interval=5'),
                apiFetch('OHLC?pair=XRPEUR&interval=15'),
                apiFetch('OHLC?pair=XRPEUR&interval=60'),
                apiFetch('OHLC?pair=XRPEUR&interval=240')
            ]);
            
            // Process XRP ticker
            const xk = Object.keys(tick.result || {}).find(k => k.includes('XRP'));
            if (xk) {
                const t = tick.result[xk];
                price = +t.c[0];
                openP = +t.o;
                $('price').textContent = '‚Ç¨' + price.toFixed(4);
                $('hi').textContent = '‚Ç¨' + (+t.h[1]).toFixed(4);
                $('lo').textContent = '‚Ç¨' + (+t.l[1]).toFixed(4);
                $('vol').textContent = fmtVol(+t.v[1]);
                
                const chg = ((price - openP) / openP) * 100;
                $('chg').textContent = (chg >= 0 ? '+' : '') + chg.toFixed(2) + '%';
                $('chg').className = 'change ' + (chg >= 0 ? 'up' : 'dn');
            }
            
            // Process BTC
            const bk = Object.keys(btcTick.result || {}).find(k => k.includes('XBT'));
            if (bk) {
                const b = btcTick.result[bk];
                btcChange = ((+b.c[0] - +b.o) / +b.o) * 100;
                btcTrend = btcChange > 0.5 ? 'bull' : (btcChange < -0.5 ? 'bear' : 'neut');
            }
            
            // Process OHLC for each timeframe
            processOHLC(ohlc5, 5);
            processOHLC(ohlc15, 15);
            processOHLC(ohlc60, 60);
            processOHLC(ohlc240, 240);
            
            // Calculate indicators for all timeframes
            for (const tf of [5, 15, 60, 240]) {
                tfData[tf].ind = calcIndicators(tfData[tf].ohlc);
            }
            
            // Update all displays
            updateMTFCards();
            updateChart();
            updateDisplayIndicators();
            generateRecommendation();
            updateCalculator();
            
            setStatus('ok');
            hideError();
            
        } catch(e) {
            console.error('Load error:', e);
            setStatus('err');
            showError('Failed to load data: ' + e.message);
        }
    }
    
    function processOHLC(data, tf) {
        const key = Object.keys(data.result || {}).find(k => k !== 'last');
        if (key) {
            tfData[tf].ohlc = data.result[key].map(c => ({
                time: c[0] * 1000,
                o: +c[1], h: +c[2], l: +c[3], c: +c[4], v: +c[6]
            }));
        }
    }
    
    function calcIndicators(ohlc) {
        if (!ohlc || ohlc.length < 30) return null;
        
        const d = ohlc.slice(-50);
        const cls = d.map(x => x.c);
        const his = d.map(x => x.h);
        const los = d.map(x => x.l);
        const vols = d.map(x => x.v);
        
        // RSI
        let g = 0, l = 0;
        for (let i = cls.length - 14; i < cls.length; i++) {
            const ch = cls[i] - cls[i - 1];
            if (ch > 0) g += ch; else l -= ch;
        }
        const rsi = l === 0 ? 100 : 100 - 100 / (1 + g / l);
        
        // MACD
        const e12 = ema(cls, 12), e26 = ema(cls, 26);
        const macd = e12 - e26;
        
        // Bollinger Bands
        const sl = cls.slice(-20);
        const mid = sl.reduce((a, b) => a + b) / 20;
        const std = Math.sqrt(sl.reduce((s, p) => s + (p - mid) ** 2, 0) / 20);
        const bbUp = mid + 2 * std, bbLo = mid - 2 * std;
        const bbPos = (bbUp - bbLo) > 0 ? (cls[cls.length - 1] - bbLo) / (bbUp - bbLo) : 0.5;
        
        // ATR
        let atr = 0;
        for (let i = d.length - 14; i < d.length; i++) {
            atr += Math.max(his[i] - los[i], Math.abs(his[i] - cls[i - 1]), Math.abs(los[i] - cls[i - 1]));
        }
        atr /= 14;
        
        // Volume ratio
        const avgV = vols.slice(-21, -1).reduce((a, b) => a + b) / 20;
        const volRatio = avgV > 0 ? vols[vols.length - 1] / avgV : 1;
        
        // Determine bias
        let score = 0;
        if (rsi < 35) score += 2;
        else if (rsi < 45) score += 1;
        else if (rsi > 65) score -= 2;
        else if (rsi > 55) score -= 1;
        
        if (macd > 0) score += 1;
        else if (macd < 0) score -= 1;
        
        if (bbPos < 0.2) score += 1;
        else if (bbPos > 0.8) score -= 1;
        
        let bias = 'neutral';
        if (score >= 2) bias = 'bullish';
        else if (score <= -2) bias = 'bearish';
        
        return { rsi, macd, bbPos, atr, volRatio, score, bias };
    }
    
    function ema(arr, p) {
        if (arr.length < p) return arr[arr.length - 1] || 0;
        const m = 2 / (p + 1);
        let e = arr.slice(0, p).reduce((a, b) => a + b) / p;
        for (let i = p; i < arr.length; i++) e = (arr[i] - e) * m + e;
        return e;
    }
    
    function updateMTFCards() {
        const tfMap = { 240: '4h', 60: '1h', 15: '15m', 5: '5m' };
        
        for (const [tf, suffix] of Object.entries(tfMap)) {
            const ind = tfData[tf].ind;
            const card = $('mtf' + suffix);
            const biasEl = $('bias' + suffix);
            const detailEl = $('detail' + suffix);
            
            if (!ind) continue;
            
            card.className = 'mtf-card' + (ind.bias === 'bullish' ? ' bullish' : (ind.bias === 'bearish' ? ' bearish' : ''));
            
            biasEl.textContent = ind.bias === 'bullish' ? '‚Üë BULL' : (ind.bias === 'bearish' ? '‚Üì BEAR' : '‚Äî NEUT');
            biasEl.className = 'mtf-bias ' + (ind.bias === 'bullish' ? 'bull' : (ind.bias === 'bearish' ? 'bear' : 'neut'));
            
            detailEl.textContent = `RSI: ${ind.rsi.toFixed(0)} | BB: ${(ind.bbPos * 100).toFixed(0)}%`;
        }
    }
    
    function generateRecommendation() {
        const ind4h = tfData[240].ind;
        const ind1h = tfData[60].ind;
        const ind15m = tfData[15].ind;
        const ind5m = tfData[5].ind;
        
        if (!ind4h || !ind1h || !ind15m || !ind5m) {
            $('recAction').textContent = 'LOADING...';
            $('recReason').textContent = 'Waiting for all timeframe data...';
            return;
        }
        
        // Evaluate LONG conditions
        const longChecks = {
            trend4h: ind4h.bias === 'bullish',
            setup1h: ind1h.bias === 'bullish',
            entry15m: ind15m.rsi < 35, // Oversold = buy signal
            volume: ind15m.volRatio > 1.3,
            btcAlign: btcTrend !== 'bear',
            rsiExtreme: ind15m.rsi < 35
        };
        
        // Evaluate SHORT conditions
        const shortChecks = {
            trend4h: ind4h.bias === 'bearish',
            setup1h: ind1h.bias === 'bearish',
            entry15m: ind15m.rsi > 65, // Overbought = sell signal
            volume: ind15m.volRatio > 1.3,
            btcAlign: btcTrend !== 'bull',
            rsiExtreme: ind15m.rsi > 65
        };
        
        const longPassed = Object.values(longChecks).filter(Boolean).length;
        const shortPassed = Object.values(shortChecks).filter(Boolean).length;
        
        // Update score display
        $('longScore').textContent = longPassed;
        $('longScore').style.color = longPassed >= 5 ? 'var(--green)' : (longPassed >= 3 ? 'var(--yellow)' : 'var(--text3)');
        $('shortScore').textContent = shortPassed;
        $('shortScore').style.color = shortPassed >= 5 ? 'var(--red)' : (shortPassed >= 3 ? 'var(--yellow)' : 'var(--text3)');
        
        // Determine which setup is stronger
        const bestSetup = longPassed >= shortPassed ? 'long' : 'short';
        const bestChecks = bestSetup === 'long' ? longChecks : shortChecks;
        const bestPassed = Math.max(longPassed, shortPassed);
        
        // Update setup direction indicator
        const setupDir = $('setupDir');
        if (longPassed >= 4 && longPassed > shortPassed) {
            setupDir.innerHTML = 'üü¢ <strong style="color:var(--green)">LONG setup forming</strong> ‚Äî Looking for oversold bounce';
            setupDir.style.borderLeft = '3px solid var(--green)';
        } else if (shortPassed >= 4 && shortPassed > longPassed) {
            setupDir.innerHTML = 'üî¥ <strong style="color:var(--red)">SHORT setup forming</strong> ‚Äî Looking for overbought rejection';
            setupDir.style.borderLeft = '3px solid var(--red)';
        } else if (longPassed >= 3 || shortPassed >= 3) {
            setupDir.innerHTML = 'üü° <strong style="color:var(--yellow)">Setup developing</strong> ‚Äî Wait for more confirmation';
            setupDir.style.borderLeft = '3px solid var(--yellow)';
        } else {
            setupDir.innerHTML = '‚ö™ <strong>No clear setup</strong> ‚Äî Both directions lack confirmation';
            setupDir.style.borderLeft = '3px solid var(--text3)';
        }
        
        // Update checklist UI - show the better setup's status
        updateChecklist(bestChecks, bestSetup, ind4h, ind1h, ind15m);
        
        // Determine recommendation
        let action = 'WAIT';
        let reason = '';
        let confidence = 0;
        let actionClass = 'wait';
        
        if (longPassed >= 5) {
            action = 'LONG';
            actionClass = 'long';
            reason = `Strong LONG setup: 4H bullish, 1H confirms, 15m RSI oversold at ${ind15m.rsi.toFixed(0)}. Volume ${ind15m.volRatio.toFixed(1)}x.`;
            confidence = 50 + longPassed * 8;
        } else if (shortPassed >= 5) {
            action = 'SHORT';
            actionClass = 'short';
            reason = `Strong SHORT setup: 4H bearish, 1H confirms, 15m RSI overbought at ${ind15m.rsi.toFixed(0)}. Volume ${ind15m.volRatio.toFixed(1)}x.`;
            confidence = 50 + shortPassed * 8;
        } else if (bestPassed >= 4) {
            action = 'WAIT';
            const missing = [];
            if (!bestChecks.trend4h) missing.push('4H trend');
            if (!bestChecks.setup1h) missing.push('1H setup');
            if (!bestChecks.entry15m) missing.push('15m RSI signal');
            if (!bestChecks.volume) missing.push('volume');
            if (!bestChecks.btcAlign) missing.push('BTC alignment');
            reason = `${bestSetup.toUpperCase()} setup at ${bestPassed}/6. Missing: ${missing.join(', ')}. Wait for confirmation.`;
            confidence = 30 + bestPassed * 5;
        } else {
            action = 'WAIT';
            reason = `No clear setup. LONG: ${longPassed}/6, SHORT: ${shortPassed}/6. Wait for timeframes to align.`;
            confidence = 10 + bestPassed * 5;
        }
        
        // Check for 5m spike (can override WAIT)
        if (ind5m.volRatio > 2 && (ind5m.rsi < 25 || ind5m.rsi > 75)) {
            const spikeDir = ind5m.rsi < 25 ? 'LONG' : 'SHORT';
            if (action === 'WAIT') {
                action = 'SPIKE ' + (spikeDir === 'LONG' ? '‚Üë' : '‚Üì');
                reason = `‚ö° 5m spike: RSI ${ind5m.rsi.toFixed(0)}, Volume ${ind5m.volRatio.toFixed(1)}x. Quick ${spikeDir.toLowerCase()} with tight stop!`;
                confidence = 55;
                actionClass = spikeDir === 'LONG' ? 'long' : 'short';
            }
        }
        
        // Update UI
        const recBox = $('recBox');
        recBox.className = 'rec-box ' + actionClass;
        $('recAction').textContent = action;
        $('recAction').className = 'rec-action ' + actionClass;
        $('recReason').textContent = reason;
        $('recConf').style.width = Math.min(confidence, 95) + '%';
        $('recConf').style.background = confidence > 60 ? 'var(--green)' : (confidence > 40 ? 'var(--yellow)' : 'var(--red)');
        $('recConfPct').textContent = Math.min(confidence, 95) + '%';
        
        // Enable/disable buttons
        $('btnLong').disabled = !(action === 'LONG' || action === 'SPIKE ‚Üë');
        $('btnShort').disabled = !(action === 'SHORT' || action === 'SPIKE ‚Üì');
        
        // Notify on new signal
        if (action !== 'WAIT' && action !== lastRecommendation) {
            toast('üéØ Signal: ' + action, reason.substring(0, 100));
        }
        lastRecommendation = action;
    }
    
    function updateChecklist(checks, direction, ind4h, ind1h, ind15m) {
        const items = [
            { 
                pass: checks.trend4h, 
                val: ind4h.bias + (checks.trend4h ? ' ‚úì' : '')
            },
            { 
                pass: checks.setup1h, 
                val: ind1h.bias + (checks.setup1h ? ' ‚úì' : '')
            },
            { 
                pass: checks.entry15m, 
                val: 'RSI ' + ind15m.rsi.toFixed(0) + (direction === 'long' ? ' (need <35)' : ' (need >65)')
            },
            { 
                pass: checks.volume, 
                val: ind15m.volRatio.toFixed(2) + 'x'
            },
            { 
                pass: checks.btcAlign, 
                val: btcTrend + ' ' + btcChange.toFixed(1) + '%'
            },
            { 
                pass: checks.rsiExtreme, 
                val: ind15m.rsi.toFixed(0)
            }
        ];
        
        items.forEach((item, i) => {
            const icon = $('chk' + i);
            icon.className = 'chk-icon ' + (item.pass ? 'pass' : 'fail');
            icon.textContent = item.pass ? '‚úì' : '‚úó';
            $('chk' + i + 'v').textContent = item.val;
        });
    }
    
    function updateDisplayIndicators() {
        const ind = tfData[displayTf].ind;
        if (!ind) return;
        
        $('indRsi').textContent = ind.rsi.toFixed(1);
        $('indRsiS').textContent = ind.rsi < 35 ? 'Oversold' : (ind.rsi > 65 ? 'Overbought' : 'Neutral');
        $('indRsiS').style.color = ind.rsi < 35 ? 'var(--green)' : (ind.rsi > 65 ? 'var(--red)' : 'var(--text3)');
        
        $('indMacd').textContent = (ind.macd * 10000).toFixed(1);
        $('indMacdS').textContent = ind.macd > 0 ? 'Bullish' : 'Bearish';
        $('indMacdS').style.color = ind.macd > 0 ? 'var(--green)' : 'var(--red)';
        
        $('indBb').textContent = (ind.bbPos * 100).toFixed(0) + '%';
        $('indBbS').textContent = ind.bbPos < 0.2 ? 'Lower' : (ind.bbPos > 0.8 ? 'Upper' : 'Middle');
        $('indBbS').style.color = ind.bbPos < 0.2 ? 'var(--green)' : (ind.bbPos > 0.8 ? 'var(--red)' : 'var(--text3)');
        
        const atrPct = price > 0 ? (ind.atr / price) * 100 : 0;
        $('indAtr').textContent = atrPct.toFixed(2) + '%';
        $('indAtrS').textContent = atrPct > 2 ? 'High' : 'Normal';
        $('indAtrS').style.color = atrPct > 2 ? 'var(--orange)' : 'var(--text3)';
        
        $('indVol').textContent = ind.volRatio.toFixed(2) + 'x';
        $('indVolS').textContent = ind.volRatio > 1.5 ? 'High' : 'Avg';
        $('indVolS').style.color = ind.volRatio > 1.5 ? 'var(--green)' : 'var(--text3)';
        
        $('indBtc').textContent = btcChange.toFixed(1) + '%';
        $('indBtcS').textContent = btcTrend === 'bull' ? 'Bullish' : (btcTrend === 'bear' ? 'Bearish' : 'Neutral');
        $('indBtcS').style.color = btcTrend === 'bull' ? 'var(--green)' : (btcTrend === 'bear' ? 'var(--red)' : 'var(--text3)');
    }
    
    function updateCalculator() {
        const cap = +$('cap').value || 2000;
        const targ = +$('targ').value || 500;
        const lev = 10;
        const entry = price;
        
        if (!entry) return;
        
        const pos = cap * lev;
        const mv = (targ / pos) * 100;
        
        $('pos').textContent = '‚Ç¨' + pos.toLocaleString();
        $('mv').textContent = mv.toFixed(2) + '%';
        $('tp').textContent = '‚Ç¨' + (entry * (1 + mv / 100)).toFixed(4);
        $('sl').textContent = '‚Ç¨' + (entry * 0.92).toFixed(4);
        
        $('d0').textContent = '‚Ç¨' + entry.toFixed(4);
        $('d1').textContent = '‚Ç¨' + (entry * 0.97).toFixed(4);
        $('d2').textContent = '‚Ç¨' + (entry * 0.95).toFixed(4);
        $('d3').textContent = '‚Ç¨' + (entry * 0.92).toFixed(4);
    }
    
    function setupChart() {
        const ctx = $('chart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'line',
            data: { labels: [], datasets: [{ data: [], borderColor: '#58a6ff', borderWidth: 2, fill: false, tension: 0.1, pointRadius: 0 }] },
            options: {
                responsive: true, maintainAspectRatio: false, animation: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { type: 'time', time: { unit: 'hour' }, grid: { color: '#21262d' }, ticks: { color: '#6e7681', maxTicksLimit: 6 } },
                    y: { position: 'right', grid: { color: '#21262d' }, ticks: { color: '#6e7681', callback: v => '‚Ç¨' + v.toFixed(4) } }
                }
            }
        });
    }
    
    function updateChart() {
        const ohlc = tfData[displayTf].ohlc;
        if (!ohlc || !ohlc.length) return;
        const d = ohlc.slice(-60);
        chart.data.labels = d.map(x => new Date(x.time));
        chart.data.datasets[0].data = d.map(x => x.c);
        chart.update('none');
    }
    
    function setupEvents() {
        document.querySelectorAll('.tf-btn').forEach(b => b.addEventListener('click', e => {
            document.querySelectorAll('.tf-btn').forEach(x => x.classList.remove('on'));
            e.target.classList.add('on');
            displayTf = +e.target.dataset.tf;
            updateChart();
            updateDisplayIndicators();
        }));
        
        ['cap', 'targ'].forEach(id => $(id).addEventListener('input', updateCalculator));
    }
    
    function setStatus(s) {
        $('dot').className = 'dot' + (s === 'ok' ? ' ok' : (s === 'err' ? ' err' : ''));
        $('statusTxt').textContent = s === 'ok' ? 'Live' : (s === 'err' ? 'Error' : 'Loading...');
    }
    
    function showError(msg) { $('errBox').textContent = msg; $('errBox').classList.add('show'); }
    function hideError() { $('errBox').classList.remove('show'); }
    
    function fmtVol(v) { return v >= 1e6 ? (v / 1e6).toFixed(1) + 'M' : (v >= 1e3 ? (v / 1e3).toFixed(0) + 'K' : v.toFixed(0)); }
    
    function toast(title, msg) {
        const box = $('toasts');
        if (box.children.length >= 3) box.firstChild.remove();
        const t = document.createElement('div');
        t.className = 'toast';
        t.innerHTML = `<div class="toast-title">${title}</div><div class="toast-msg">${msg}</div>`;
        box.appendChild(t);
        setTimeout(() => t.remove(), 10000);
    }
    
    init();
})();
</script>
</body>
</html>
